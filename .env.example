# ================================================================
# prime-jennie Configuration
# ================================================================
# 1. Copy this file: cp .env.example .env
# 2. Fill in required values (marked with REQUIRED)
# 3. All values have sensible defaults unless noted
# 4. install.sh will auto-generate Airflow secrets on first run
# ================================================================

# ─── Runtime ─────────────────────────────────────────────────────
APP_ENV=production                     # development | staging | production
APP_DEBUG=false
APP_LOG_LEVEL=INFO
APP_TIMEZONE=Asia/Seoul
TRADING_MODE=REAL                      # REAL | MOCK (모의투자)
DRY_RUN=false                          # true면 주문 미실행

# ─── Docker Data Directory ─────────────────────────────────────
# Docker 볼륨 데이터 저장 경로. 기본값: /docker_data
# 다른 경로를 사용하려면 변경 후 디렉토리를 먼저 생성하세요.
DOCKER_DATA_DIR=/docker_data

# ─── Database (MariaDB) ─────────────────────────────────────────
DB_HOST=localhost
DB_PORT=3307
DB_USER=prime                          # REQUIRED
DB_PASSWORD=                           # REQUIRED
DB_NAME=prime_jennie

# ─── Redis ───────────────────────────────────────────────────────
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_PASSWORD=

# ─── KIS (한국투자증권 API) ──────────────────────────────────────
# REQUIRED: 한투 Open API 발급 정보 (https://apiportal.koreainvestment.com)
KIS_APP_KEY=                           # REQUIRED
KIS_APP_SECRET=                        # REQUIRED
KIS_ACCOUNT_NO=                        # REQUIRED (계좌번호 8자리)
KIS_ACCOUNT_PRODUCT_CODE=01
KIS_BASE_URL=https://openapi.koreainvestment.com:9443
KIS_IS_PAPER=false                     # true=모의투자
KIS_TOKEN_FILE_PATH=/app/config/kis_token.json
KIS_GATEWAY_URL=http://kis-gateway:8080

# ─── LLM Providers ──────────────────────────────────────────────
# GPU 모드 (기본): vLLM 로컬 + DeepSeek Cloud
#   - LLM_TIER_FAST_PROVIDER=ollama (로컬 vLLM 사용)
#   - GPU 필요: NVIDIA GPU + docker nvidia runtime
#
# Cloud 모드 (GPU 없음): docker-compose.no-gpu.yml 오버라이드 사용
#   - LLM_TIER_FAST_PROVIDER=deepseek_cloud (자동 전환)
#   - 실행: docker compose -f docker-compose.yml -f docker-compose.no-gpu.yml --profile infra --profile real up -d
LLM_TIER_FAST_PROVIDER=ollama          # ollama | openai | claude | gemini | deepseek_cloud
LLM_TIER_REASONING_PROVIDER=deepseek_cloud  # deepseek_cloud → CloudFailoverProvider
LLM_TIER_THINKING_PROVIDER=deepseek_cloud
LLM_VLLM_LLM_URL=http://vllm-llm:8001/v1
LLM_VLLM_EMBED_URL=http://vllm-embed:8002/v1
LLM_VLLM_MAX_MODEL_LEN=4096
# 임베딩 모델 (GPU 모드: vllm, Cloud 모드: openai)
LLM_EMBED_MODEL=nlpai-lab/KURE-v1
LLM_EMBED_PROVIDER=vllm                # vllm | openai
# Provider별 모델명 (기본값 사용 시 생략 가능)
# LLM_CLAUDE_MODEL=claude-sonnet-4-5-20250514
# LLM_GEMINI_MODEL=gemini-2.5-flash
# LLM_OPENAI_MODEL=gpt-4o-mini

# LLM API Keys (at least one REASONING provider key required)
OPENROUTER_API_KEY=                    # REQUIRED: OpenRouter (deepseek_cloud primary)
DEEPSEEK_API_KEY=                      # DeepSeek direct (failover)
GEMINI_API_KEY=                        # Google Gemini
OPENAI_API_KEY=                        # OpenAI (Cloud 모드 임베딩 시 필요)
ANTHROPIC_API_KEY=                     # Anthropic Claude

# ─── Telegram ────────────────────────────────────────────────────
TELEGRAM_BOT_TOKEN=                    # REQUIRED: 텔레그램 봇 토큰
TELEGRAM_CHAT_IDS=                     # REQUIRED: 알림 채팅방 ID (콤마 구분 복수 가능)
TELEGRAM_API_ID=                       # Telethon용 API ID (my.telegram.org)
TELEGRAM_API_HASH=                     # Telethon용 API Hash

# ─── Risk Management ────────────────────────────────────────────
RISK_MAX_PORTFOLIO_SIZE=10             # 최대 보유 종목 수
RISK_MAX_SECTOR_STOCKS=3              # 섹터당 최대 종목 수 (고정 fallback)
RISK_PORTFOLIO_GUARD_ENABLED=true
RISK_DYNAMIC_SECTOR_BUDGET_ENABLED=true
# 국면별 현금 하한선 (%)
RISK_CASH_FLOOR_STRONG_BULL_PCT=5.0
RISK_CASH_FLOOR_BULL_PCT=10.0
RISK_CASH_FLOOR_SIDEWAYS_PCT=15.0
RISK_CASH_FLOOR_BEAR_PCT=25.0
# 매매 제한
RISK_MAX_BUY_COUNT_PER_DAY=6
RISK_MAX_POSITION_VALUE_PCT=10.0       # 종목당 최대 비중 (%)
RISK_STOPLOSS_COOLDOWN_DAYS=3

# ─── Scoring ─────────────────────────────────────────────────────
SCORING_QUANT_SCORER_VERSION=v2        # v1 | v2 (잠재력 기반)
SCORING_UNIFIED_ANALYST_ENABLED=true   # Unified Analyst Pipeline
SCORING_LLM_CLAMP_RANGE=15            # ±15pt 가드레일
SCORING_HARD_FLOOR_SCORE=40.0         # 이하 → BLOCKED

# ─── Scanner ─────────────────────────────────────────────────────
SCANNER_MIN_REQUIRED_BARS=20
SCANNER_SIGNAL_COOLDOWN_SECONDS=600
SCANNER_RSI_GUARD_MAX=75.0
SCANNER_VOLUME_RATIO_WARNING=2.0
SCANNER_VWAP_DEVIATION_WARNING=0.02
SCANNER_NO_TRADE_WINDOW_START=09:00
SCANNER_NO_TRADE_WINDOW_END=09:15
SCANNER_DANGER_ZONE_START=14:00
SCANNER_DANGER_ZONE_END=15:00
# Conviction Entry (비활성화 — 쿨다운 미적용 이슈)
SCANNER_CONVICTION_ENTRY_ENABLED=false
SCANNER_CONVICTION_MIN_HYBRID_SCORE=70.0
SCANNER_CONVICTION_MIN_LLM_SCORE=72.0
SCANNER_CONVICTION_MAX_GAIN_PCT=3.0
SCANNER_CONVICTION_WINDOW_START=09:15
SCANNER_CONVICTION_WINDOW_END=10:30
# Momentum (지정가 주문)
SCANNER_MOMENTUM_LIMIT_ORDER_ENABLED=true
SCANNER_MOMENTUM_LIMIT_PREMIUM=0.003
SCANNER_MOMENTUM_LIMIT_TIMEOUT_SEC=10
SCANNER_MOMENTUM_CONFIRMATION_BARS=1
SCANNER_MOMENTUM_MAX_GAIN_PCT=7.0

# ─── Scout ───────────────────────────────────────────────────────
SCOUT_MAX_WATCHLIST_SIZE=20
SCOUT_UNIVERSE_SIZE=200
SCOUT_ENABLE_NEWS_ANALYSIS=true
SCOUT_MIN_MARKET_CAP=50000             # 시총 하한 (백만원 단위, 50000=500억)
SCOUT_MA_WINDOW=3                      # 점수 이동평균 윈도우
SCOUT_ENTRY_THRESHOLD=62.0             # 신규 진입 최소 MA score
SCOUT_EXIT_THRESHOLD=55.0              # 기존 종목 이탈 MA score
SCOUT_HISTORY_RETENTION_DAYS=30        # daily_quant_scores 보존 기간
SCOUT_UNIVERSE_MARKET=KOSPI            # KOSPI | KOSDAQ

# ─── Selling ─────────────────────────────────────────────────────
SELL_RSI_OVERBOUGHT_THRESHOLD=75.0
SELL_TRAILING_ENABLED=true
SELL_TRAILING_ACTIVATION_PCT=5.0
SELL_TRAILING_ATR_MULT=1.5
SELL_PROFIT_TARGET_PCT=8.0
SELL_STOP_LOSS_PCT=5.0
SELL_TIME_EXIT_BULL_DAYS=20
SELL_TIME_EXIT_SIDEWAYS_DAYS=35

# ─── Signal Parameters ──────────────────────────────────────────
SIGNAL_GOLDEN_CROSS_SHORT=5
SIGNAL_GOLDEN_CROSS_LONG=20
SIGNAL_RSI_OVERSOLD=30
SIGNAL_RSI_OVERSOLD_BULL=40

# ─── Infrastructure ─────────────────────────────────────────────
INFRA_QDRANT_URL=http://localhost:6333
INFRA_QDRANT_HOST=localhost
INFRA_QDRANT_PORT=6333
INFRA_DART_API_KEY=                    # DART 공시 API 키 (optional)
KRX_OPEN_API_KEY=                      # KRX Open Data API 키 (향후 전환용)

# ─── Airflow Secrets ─────────────────────────────────────────────
# install.sh가 자동 생성합니다. 수동 설정 시 아래 값을 채우세요.
AIRFLOW_FERNET_KEY=                    # python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
AIRFLOW_SECRET_KEY=                    # openssl rand -base64 16
AIRFLOW_JWT_SECRET=                    # openssl rand -base64 32
AIRFLOW_ADMIN_PASSWORD=admin

# ─── Cloudflare Tunnel (optional) ────────────────────────────────
# CLOUDFLARE_TUNNEL_TOKEN=              # 외부 접속 필요 시
